---
title: "Proyecto 1 – Maternidad Adolescente en Guatemala (2009–2023)"
author: "Grupo 6"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Introducción

Guatemala presenta históricamente altas tasas de maternidad adolescente, fenómeno asociado a desigualdades territoriales y educativas.

Este proyecto analiza la evolución y distribución territorial de los nacimientos en madres menores de 18 años utilizando registros oficiales del Instituto Nacional de Estadística (INE) correspondientes al período 2009–2023.

Preguntas de investigación:

- ¿Ha disminuido o aumentado la proporción de nacimientos en madres menores de 18 años entre 2009 y 2023?
- ¿Se concentra más en áreas rurales?
- ¿Existe relación entre nivel educativo y maternidad temprana?
- ¿Hay departamentos con patrones extremos?
- ¿El fenómeno presenta agrupamiento territorial?

---

# 2. Descripción General del Conjunto de Datos

El conjunto de datos corresponde a registros individuales de nacimientos del INE.

- Número total de observaciones: 5,195,195
- Número de variables originales: 61
- Periodo: 2009–2023

Principales variables utilizadas:

| Variable | Descripción | Tipo |
|----------|------------|------|
| Añoreg | Año de registro | Numérica |
| Edadm | Edad de la madre | Numérica |
| Areag | Área geográfica (1=Urbano, 2=Rural) | Categórica |
| Escivm | Nivel educativo madre | Categórica |
| Deprem | Departamento de residencia | Categórica |

---

# 3. Carga y Unión de Datos

```{r carga_datos}
library(haven)
library(dplyr)
library(ggplot2)
library(cluster)
library(factoextra)

archivos <- list.files("Datos", pattern = "\\.sav$", full.names = TRUE)

lista_datos <- lapply(archivos, function(x) {
  df <- read_sav(x)
  df <- zap_labels(df)
  df[] <- lapply(df, as.character)
  df
})

datos_unidos <- bind_rows(lista_datos)

length(archivos)
dim(datos_unidos)
```

---

# 4. Limpieza y Preparación

## Corrección del año

```{r year_fix}
datos_unidos$Añoreg <- ifelse(nchar(datos_unidos$Añoreg) == 1,
                              paste0("200", datos_unidos$Añoreg),
                              ifelse(nchar(datos_unidos$Añoreg) == 2,
                                     paste0("20", datos_unidos$Añoreg),
                                     datos_unidos$Añoreg))

datos_unidos$Añoreg <- as.numeric(datos_unidos$Añoreg)
table(datos_unidos$Añoreg)
```

## Limpieza de edad materna

```{r edad_limpia}
datos_unidos$Edadm <- as.numeric(datos_unidos$Edadm)
datos_unidos$Edadm[datos_unidos$Edadm == 999] <- NA
summary(datos_unidos$Edadm)
```

## Variable maternidad adolescente

```{r adolescente}
datos_unidos$adolescente <- ifelse(datos_unidos$Edadm < 18, 1, 0)
table(datos_unidos$adolescente)
```

---

# 5. Análisis Exploratorio

## 5.1 Distribución de Edad Materna

```{r dist_edad}
ggplot(datos_unidos, aes(x = Edadm)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribución de Edad Materna",
       x = "Edad",
       y = "Frecuencia")
```

---

## 5.2 Evolución Temporal

```{r evolucion}
prop_anual <- datos_unidos %>%
  group_by(Añoreg) %>%
  summarise(prop_adolescente = mean(adolescente, na.rm = TRUE))

ggplot(prop_anual, aes(x = Añoreg, y = prop_adolescente)) +
  geom_line() +
  geom_point() +
  labs(title = "Evolución de la Maternidad Adolescente",
       x = "Año",
       y = "Proporción")
```

---

## 5.3 Urbano vs Rural

```{r ruralidad}
datos_unidos$Areag <- as.numeric(datos_unidos$Areag)
datos_unidos$Areag[datos_unidos$Areag == 9] <- NA

prop_area <- datos_unidos %>%
  filter(!is.na(Areag)) %>%
  group_by(Areag) %>%
  summarise(prop_adolescente = mean(adolescente, na.rm = TRUE))

prop_area
```

---

## 5.4 Nivel Educativo

```{r educacion}
datos_unidos$Escivm <- as.numeric(datos_unidos$Escivm)
datos_unidos$Escivm[datos_unidos$Escivm == 9] <- NA

prop_educ <- datos_unidos %>%
  filter(!is.na(Escivm)) %>%
  group_by(Escivm) %>%
  summarise(prop_adolescente = mean(adolescente, na.rm = TRUE))

prop_educ
```

---

## 5.5 Departamentos con Patrones Extremos

```{r deptos}
datos_unidos$Deprem <- as.numeric(datos_unidos$Deprem)
datos_unidos$Deprem[datos_unidos$Deprem == 99] <- NA

prop_depto <- datos_unidos %>%
  filter(!is.na(Deprem)) %>%
  group_by(Deprem) %>%
  summarise(prop_adolescente = mean(adolescente, na.rm = TRUE)) %>%
  arrange(desc(prop_adolescente))

head(prop_depto)
tail(prop_depto)
```

---

# 6. Construcción Dataset para Clustering

```{r agregacion}
datos_cluster <- datos_unidos %>%
  filter(!is.na(Deprem)) %>%
  group_by(Deprem) %>%
  summarise(
    prop_adolescente = mean(adolescente, na.rm = TRUE),
    prop_rural = mean(Areag == 2, na.rm = TRUE),
    edad_promedio = mean(Edadm, na.rm = TRUE),
    prop_baja_educ = mean(Escivm == 1, na.rm = TRUE)
  )

datos_cluster
```

---

# 7. Estandarización

```{r escalado}
datos_scaled <- scale(datos_cluster[, -1])
```

---

# 8. Método del Codo

```{r elbow}
fviz_nbclust(datos_scaled, kmeans, method = "wss")
```

---

# 9. Clustering K-means

```{r kmeans}
set.seed(123)
kmeans_model <- kmeans(datos_scaled, centers = 3, nstart = 25)

datos_cluster$cluster <- kmeans_model$cluster
datos_cluster
```

---

# 10. Validación con Silhouette

```{r silhouette}
sil <- silhouette(kmeans_model$cluster, dist(datos_scaled))
fviz_silhouette(sil)
```

---

# 11. Conclusiones

- Se identificó la tendencia temporal de la maternidad adolescente.
- Se evaluaron diferencias entre áreas urbanas y rurales.
- Se evidenció relación estructural con nivel educativo.
- Se detectaron departamentos con patrones extremos.
- El clustering permitió identificar agrupamientos territoriales con características demográficas similares.

Estos resultados permiten comprender la estructura territorial del fenómeno en Guatemala.
